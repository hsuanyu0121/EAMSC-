<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>P!LOT | Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .risk-card { border-left: 10px solid #EF4444; background: #FFF1F1; animation: pulse-bg 2s infinite; }
        @keyframes pulse-bg { 0% { background: #FFF1F1; } 50% { background: #FFE4E4; } 100% { background: #FFF1F1; } }
    </style>
</head>
<body class="p-10 bg-slate-50 font-sans">
    <header class="mb-12 flex justify-between items-center">
        <div><h1 class="text-4xl font-black italic text-[#6B8E23]">P!LOT Monitor</h1><p class="text-xs font-bold opacity-30 tracking-widest uppercase">Live Clinical Data Stream</p></div>
        <div id="status" class="text-xs font-bold text-green-500 flex items-center gap-2">● Connected</div>
    </header>

    <div id="monitorGrid" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>

    <script>
        const firebaseConfig = { /* SAME AS ABOVE */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Audio alert for high risk
        const alertSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

        db.collection("monitor_center").orderBy("timestamp", "desc").onSnapshot(snapshot => {
            const grid = document.getElementById('monitorGrid');
            grid.innerHTML = "";
            let riskDetected = false;

            snapshot.forEach(doc => {
                const d = doc.data();
                const anxiety = parseFloat(d.anxiety_reduction);
                const isRisk = anxiety > 5;
                if(isRisk) riskDetected = true;

                grid.innerHTML += `
                    <div class="p-8 rounded-[2.5rem] shadow-sm bg-white transition-all ${isRisk ? 'risk-card' : 'border-l-8 border-green-500'}">
                        <div class="flex items-center gap-4 mb-6">
                            <img src="${d.userAvatar}" class="w-12 h-12 rounded-full border">
                            <div><h3 class="font-bold text-slate-800">${d.userName}</h3><p class="text-[9px] opacity-30">${d.msg_type} Update</p></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-slate-50 p-4 rounded-2xl text-center"><p class="text-[9px] opacity-40">ANXIETY</p><p class="text-2xl font-black ${isRisk?'text-red-600':'text-blue-600'}">${anxiety}%</p></div>
                            <div class="bg-slate-50 p-4 rounded-2xl text-center"><p class="text-[9px] opacity-40">REWARD</p><p class="text-2xl font-black text-[#6B8E23]">${d.cumulative_reward}</p></div>
                        </div>
                        <p class="text-xs italic text-slate-500 line-clamp-2">"${d.last_msg}"</p>
                        ${isRisk ? '<p class="mt-4 text-[10px] font-black text-red-500 text-center animate-bounce uppercase">⚠️ Alert: High Stress Detected</p>' : ''}
                    </div>`;
            });

            if(riskDetected) alertSound.play().catch(e => console.log("Audio play blocked until interaction"));
        });
    </script>
</body>
</html>

           
