<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>P!LOT | Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0F172A; color: white; font-family: sans-serif; }
        .risk-alert { border: 2px solid #EF4444; background: rgba(239, 68, 68, 0.1); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0px rgba(239, 68, 68, 0.4); } 100% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } }
        .progress-bar { height: 6px; background: #334155; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 3px; transition: width 1.5s cubic-bezier(0.1, 0.7, 1.0, 0.1); }
    </style>
</head>
<body class="p-10">
    <header class="flex justify-between items-center mb-12">
        <div>
            <h1 class="text-4xl font-black italic text-[#A4C639] tracking-tighter">P!LOT Monitor</h1>
            <p class="text-xs font-bold text-slate-500 tracking-widest uppercase">Clinical RL Metrics & Behavioral Tracking</p>
        </div>
        <div class="text-xs font-black text-green-500 bg-green-500/10 px-4 py-2 rounded-full border border-green-500/20 uppercase">● Live Sync Active</div>
    </header>

    <div id="monitorGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCYXhTT_MzhE6K2OE6HuAx9kwEZlIKbZMg",
            authDomain: "eamsc-929aa.firebaseapp.com",
            projectId: "eamsc-929aa",
            storageBucket: "eamsc-929aa.firebasestorage.app",
            messagingSenderId: "1010678005753",
            appId: "1:1010678005753:web:6283391cec141c7e664728",
            measurementId: "G-TQ48PSK5H4"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        db.collection("monitor_center").orderBy("timestamp", "desc").onSnapshot(snap => {
            const grid = document.getElementById('monitorGrid');
            grid.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                const isRisk = d.anxiety > 7 || d.stress > 7;
                const isDone = d.mission_status === "COMPLETED";

                grid.innerHTML += `
                    <div class="p-8 rounded-[2.5rem] bg-slate-800 border border-slate-700 shadow-xl transition-all ${isRisk ? 'risk-alert' : ''}">
                        <div class="flex items-center gap-4 mb-8">
                            <img src="${d.avatar}" class="w-14 h-14 rounded-full border-2 border-[#A4C639]">
                            <div>
                                <h3 class="text-xl font-bold italic">${d.name}</h3>
                                <p class="text-[10px] text-[#A4C639] font-black uppercase tracking-widest">Score: ${d.award}</p>
                            </div>
                        </div>

                        <div class="mb-8 p-4 rounded-2xl ${isDone ? 'bg-green-500/20 border border-green-500/40' : 'bg-slate-900 border border-slate-700'}">
                            <p class="text-[9px] font-black opacity-40 uppercase tracking-widest mb-1">Behavioral Goal</p>
                            <p class="text-xs font-bold ${isDone ? 'text-green-400' : 'text-slate-300'}">
                                ${isDone ? '✅ COMPLETED:' : '⏳ ACTIVE:'} ${d.mission}
                            </p>
                        </div>

                        <div class="space-y-4">
                            ${renderBar("Anxiety", d.anxiety, "bg-blue-500")}
                            ${renderBar("Stress", d.stress, "bg-orange-500")}
                            ${renderBar("Depression", d.depression, "bg-purple-500")}
                        </div>

                        <div class="mt-8 pt-6 border-t border-slate-700/50">
                            <p class="text-[9px] font-black text-slate-500 uppercase mb-1">Last Interaction (${d.msg_type})</p>
                            <p class="text-xs italic text-slate-400 truncate">"${d.last_msg}"</p>
                        </div>
                    </div>`;
            });
        });

        function renderBar(label, val, color) {
            return `<div><div class="flex justify-between text-[9px] font-bold mb-1 tracking-widest"><span>${label.toUpperCase()}</span><span>${val}/10</span></div>
                    <div class="progress-bar"><div class="progress-fill ${color}" style="width: ${val*10}%"></div></div></div>`;
        }
    </script>
</body>
</html>
                        
