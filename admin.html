<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>P!LOT | Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0F172A; color: white; font-family: sans-serif; }
        .risk-card { border: 2px solid #EF4444; background: rgba(239, 68, 68, 0.1); animation: flash 2s infinite; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body class="p-10">
    <div class="flex justify-between items-center mb-10">
        <h1 class="text-3xl font-black italic text-[#A4C639]">P!LOT Monitor</h1>
        <div class="text-xs font-bold text-green-500">● Live Feed Active</div>
    </div>
    <div id="monitorGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

    <script>
        const firebaseConfig = { /* 同學生端 */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const alertSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

        db.collection("monitor_center").orderBy("timestamp", "desc").onSnapshot(snap => {
            const grid = document.getElementById('monitorGrid');
            grid.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                const isRisk = d.anxiety > 7 || d.stress > 7;
                if(isRisk) alertSound.play().catch(()=>{});

                grid.innerHTML += `
                    <div class="p-6 rounded-[2rem] bg-slate-800 border border-slate-700 ${isRisk ? 'risk-card' : ''}">
                        <div class="flex items-center gap-3 mb-6">
                            <img src="${d.avatar}" class="w-12 h-12 rounded-full border-2 border-[#A4C639]">
                            <div><h3 class="font-bold">${d.name}</h3><p class="text-[9px] text-slate-400">${d.type} Update</p></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-center text-[10px] font-bold mb-6">
                            <div class="bg-slate-900 p-2 rounded-xl"><p class="opacity-40">ANXIETY</p><p class="${d.anxiety>7?'text-red-500':''}">${d.anxiety}/10</p></div>
                            <div class="bg-slate-900 p-2 rounded-xl"><p class="opacity-40">STRESS</p><p class="${d.stress>7?'text-red-500':''}">${d.stress}/10</p></div>
                        </div>
                        <div class="p-4 bg-black/30 rounded-2xl border border-white/5 text-xs italic text-slate-400 truncate">"${d.last_msg}"</div>
                    </div>`;
            });
        });
    </script>
</body>
</html>
